<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA Moon RAG Chatbot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="module">
        import { Send, Moon, Sparkles, Loader2 } from 'https://cdn.jsdelivr.net/npm/lucide-react@0.263.1/+esm';

        const { useState, useRef, useEffect } = React;

        function NasaRagChatbot() {
            const [messages, setMessages] = useState([
                {
                    role: 'assistant',
                    content: 'Hello! I can answer questions about the Moon based on NASA documents. Ask me anything!'
                }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleSubmit = async () => {
                if (!input.trim() || isLoading) return;

                const userMessage = input.trim();
                setInput('');
                
                setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
                setIsLoading(true);

                try {
                    const response = await fetch('http://localhost:5000/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ question: userMessage }),
                    });

                    if (!response.ok) throw new Error('Failed to get response');

                    const data = await response.json();
                    
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: data.answer,
                        sources: data.sources
                    }]);
                } catch (error) {
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'âŒ Error: ' + error.message + '. Make sure Flask is running on http://localhost:5000',
                        isError: true
                    }]);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSubmit();
                }
            };

            return React.createElement('div', {
                className: "min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4"
            },
                React.createElement('div', {
                    className: "w-full max-w-4xl h-screen bg-slate-800/50 backdrop-blur-xl rounded-2xl shadow-2xl border border-slate-700/50 flex flex-col overflow-hidden"
                },
                    React.createElement('div', {
                        className: "bg-gradient-to-r from-purple-600 to-blue-600 p-6 flex items-center gap-4"
                    },
                        React.createElement('div', { className: "relative" },
                            React.createElement(Moon, { className: "w-10 h-10 text-white" }),
                            React.createElement(Sparkles, { className: "w-4 h-4 text-yellow-300 absolute -top-1 -right-1 animate-pulse" })
                        ),
                        React.createElement('div', null,
                            React.createElement('h1', { className: "text-2xl font-bold text-white" }, 'NASA Moon Explorer'),
                            React.createElement('p', { className: "text-purple-100 text-sm" }, 'Powered by RAG & OpenAI')
                        )
                    ),
                    React.createElement('div', { className: "flex-1 overflow-y-auto p-6 space-y-4" },
                        messages.map((msg, idx) =>
                            React.createElement('div', {
                                key: idx,
                                className: `flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`
                            },
                                React.createElement('div', {
                                    className: `max-w-[80%] rounded-2xl px-4 py-3 ${
                                        msg.role === 'user'
                                            ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white'
                                            : msg.isError
                                            ? 'bg-red-500/20 text-red-200 border border-red-500/50'
                                            : 'bg-slate-700/50 text-slate-100 border border-slate-600/50'
                                    }`
                                },
                                    React.createElement('p', { className: "whitespace-pre-wrap" }, msg.content),
                                    msg.sources && msg.sources.length > 0 &&
                                        React.createElement('div', { className: "mt-2 pt-2 border-t border-slate-600/50" },
                                            React.createElement('p', { className: "text-xs text-slate-400" }, 'Sources: ' + msg.sources.join(', '))
                                        )
                                )
                            )
                        ),
                        isLoading &&
                            React.createElement('div', { className: "flex justify-start" },
                                React.createElement('div', { className: "bg-slate-700/50 text-slate-100 border border-slate-600/50 rounded-2xl px-4 py-3 flex items-center gap-2" },
                                    React.createElement(Loader2, { className: "w-4 h-4 animate-spin" }),
                                    React.createElement('span', null, 'Searching NASA documents...')
                                )
                            ),
                        React.createElement('div', { ref: messagesEndRef })
                    ),
                    React.createElement('div', { className: "p-4 bg-slate-800/80 border-t border-slate-700/50" },
                        React.createElement('div', { className: "flex gap-2" },
                            React.createElement('input', {
                                type: "text",
                                value: input,
                                onChange: (e) => setInput(e.target.value),
                                onKeyPress: handleKeyPress,
                                placeholder: "Ask about the Moon...",
                                disabled: isLoading,
                                className: "flex-1 bg-slate-700/50 text-white placeholder-slate-400 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 border border-slate-600/50 disabled:opacity-50"
                            }),
                            React.createElement('button', {
                                onClick: handleSubmit,
                                disabled: isLoading || !input.trim(),
                                className: "bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-xl px-6 py-3 font-medium hover:from-purple-700 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-purple-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2"
                            },
                                React.createElement(Send, { className: "w-4 h-4" }),
                                React.createElement('span', { className: "hidden sm:inline" }, 'Send')
                            )
                        ),
                        React.createElement('p', { className: "text-xs text-slate-400 mt-2 text-center" },
                            'Powered by LangChain + ChromaDB + OpenAI'
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(NasaRagChatbot));
    </script>
</body>
</html>